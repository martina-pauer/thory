language: python # project language
os: linux # operating system
dist: focal # Ubuntu distribution

services: # services required for the build
  - xvfb # Virtual X server to simulate a graphical environment

python:
  - "3.10"
  - "3.11"

cache: pip

addons: # system packages to install on the VM
  apt:
    packages:
      - python3-gi
      - python3-gi-cairo
      - gir1.2-gtk-3.0
      - xvfb

install:
  - python -m pip install --upgrade pip setuptools wheel
  - if [ -f requirements.txt ]; then python -m pip install -r requirements.txt; fi
  - python -m pip install flake8

before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start || true

script:
  - flake8 src || true
  - xvfb-run -a python ci/import_check.py
